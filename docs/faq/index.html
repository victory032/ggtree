<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Guangchuang Yu">
        <link rel="canonical" href="https://guangchuangyu.github.io/ggtree/faq/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>FAQ - ggtree</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-77901140-1', 'guangchuangyu.github.io');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">ggtree</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Home</a>
                </li>
            
            
            
                <li >
                    <a href="../documentation/">Documentation</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">FAQ</a>
                </li>
            
            
            
                <li >
                    <a href="../featuredArticles/">Featured Articles</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">My Software <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../ChIPseeker/">ChIPseeker</a>
</li>

                    
                        
<li >
    <a href="../clusterProfiler/">clusterProfiler</a>
</li>

                    
                        
<li >
    <a href="../DOSE/">DOSE</a>
</li>

                    
                        
<li >
    <a href="../emojifont/">emojifont</a>
</li>

                    
                        
<li >
    <a href="../ggtree/">ggtree</a>
</li>

                    
                        
<li >
    <a href="../GOSemSim/">GOSemSim</a>
</li>

                    
                        
<li >
    <a href="../meshes/">meshes</a>
</li>

                    
                        
<li >
    <a href="../ReactomePA/">ReactomePA</a>
</li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../documentation/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../featuredArticles/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/GuangchuangYu/ggtree">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#installation"> Installation</a></li>
        
            <li><a href="#could-not-find-function"> Could not find function</a></li>
        
    
        <li class="main "><a href="#text-label"> Text &amp; Label</a></li>
        
            <li><a href="#tip-label-truncated"> Tip label truncated</a></li>
        
            <li><a href="#modify-tip-labels"> Modify (tip) labels</a></li>
        
            <li><a href="#formatting-tip-labels"> Formatting (tip) labels</a></li>
        
            <li><a href="#avoid-overlapping-text-labels"> Avoid overlapping text labels</a></li>
        
            <li><a href="#bootstrap-values-from-newick-format"> bootstrap values from newick format</a></li>
        
    
        <li class="main "><a href="#aesthetic-mapping"> aesthetic mapping</a></li>
        
            <li><a href="#inherit-aes"> inherit aes</a></li>
        
            <li><a href="#use-in-aes"> use $ in aes</a></li>
        
    
        <li class="main "><a href="#annotation"> Annotation</a></li>
        
            <li><a href="#colouring-edges-by-user-data"> colouring edges by user data</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<!-- AddToAny BEGIN -->

<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
<a class="a2a_dd" href="//www.addtoany.com/share"></a>
<a class="a2a_button_facebook"></a>
<a class="a2a_button_twitter"></a>
<a class="a2a_button_google_plus"></a>
<a class="a2a_button_pinterest"></a>
<a class="a2a_button_reddit"></a>
<a class="a2a_button_sina_weibo"></a>
<a class="a2a_button_wechat"></a>
<a class="a2a_button_douban"></a>
</div>

<script async src="//static.addtoany.com/menu/page.js"></script>

<!-- AddToAny END -->

<p><link rel="stylesheet" href="https://guangchuangyu.github.io/css/font-awesome.min.css"></p>
<h1 id="installation"><i class="fa fa-download"></i> Installation</h1>
<h2 id="could-not-find-function"><i class="fa fa-angle-double-right"></i> Could not find function</h2>
<p>If you got <a href="https://github.com/GuangchuangYu/ggtree/issues/12">this error</a>, please make sure you are using the latest R and <code>ggtree</code>.</p>
<p>Packages in Bioconductor, like <code>ggtree</code>, have different release policy compare to CRAN. There are two branches, release and devel, in parallel. Release branch is more stable and only document improvement and bug fixes will commit to it. New functions will only commit to <code>devel</code> branch.</p>
<p>Sometimes I may write blog post to introduce new functions which is not available in <code>release</code> branch, you need to install the <code>devel</code> version of <code>ggtree</code> in order to use these new functions.</p>
<p>You can download the <code>devel</code> version of <code>ggtree</code> from <a href="http://bioconductor.org/packages/devel/bioc/html/ggtree.html">http://bioconductor.org/packages/devel/bioc/html/ggtree.html</a> and install it, or install the github version of <code>ggtree</code>.</p>
<p>This also applied to other of my packages, including <code>GOSemSim</code>, <code>DOSE</code>, <code>clusterProfiler</code>, <code>ReactomePA</code> and <code>ChIPseeker</code>. If you got the <code>could not find function</code> error, upgrade your installation to latest release. If the error still exists after upgrading to latest release, you need to install the devel version.</p>
<h1 id="text-label"><i class="fa fa-text-height"></i> Text &amp; Label</h1>
<h2 id="tip-label-truncated"><i class="fa fa-angle-double-right"></i> Tip label truncated</h2>
<p>ggplot2 can't auto adjust xlim based on added text.</p>
<pre><code class="r">library(ggtree)
## example tree from https://support.bioconductor.org/p/72398/
tree&lt;-read.tree(text=&quot;(Organism1.006G249400.1:0.03977,(Organism2.022118m:0.01337,(Organism3.J34265.1:0.00284,Organism4.G02633.1:0.00468)0.51:0.0104):0.02469);&quot;)
ggtree(tree) + geom_tiplab()
</code></pre>

<p>This is because the units are in two different spaces (data and pixel). Users can use xlim to allocate more space for tip label.</p>
<pre><code class="r">ggtree(tree) + geom_tiplab() + xlim(0, 0.06)
</code></pre>

<h2 id="modify-tip-labels"><i class="fa fa-angle-double-right"></i> Modify (tip) labels</h2>
<p>This could be easily done via the <code>%&lt;+%</code> operator to attach the
modified version of the labels and than use <code>geom_tiplab</code> to display
the modified version.</p>
<pre><code>raxml_file &lt;- system.file(&quot;extdata/RAxML&quot;, &quot;RAxML_bipartitionsBranchLabels.H3&quot;, package=&quot;ggtree&quot;)
raxml &lt;- read.raxml(raxml_file)

lb = get.tree(raxml)$tip.label
d = data.frame(label=lb, label2 = paste(&quot;AA&quot;, substring(lb, 1, 5)))
ggtree(raxml) %&lt;+% d + geom_tiplab(aes(label=label2))
</code></pre>

<p>see also
<a href="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/bioc-ggtree/tFdFgCJ7gQA/tZ6phSgUDQAJ">1</a>
and <a href="https://github.com/GuangchuangYu/ggtree/issues/106">2</a>.</p>
<h2 id="formatting-tip-labels"><i class="fa fa-angle-double-right"></i> Formatting (tip) labels</h2>
<p>If you want to format labels, you need to set <code>parse=TRUE</code> in <code>geom_text</code>/<code>geom_tiplab</code> and the <code>label</code> should be string that can be parsed into expression and displayed as described in <code>?plotmath</code>.</p>
<p>For example, the tiplabels contains two parts, species name and accession number and we want to display species name in <em>italic</em>, we can use command like this:</p>
<pre><code>ggtree(rtree(30)) + geom_tiplab(aes(subset=node==35), label='paste(italic(&quot;species name&quot;), &quot;accession number&quot;)', parse=T)
</code></pre>

<h2 id="avoid-overlapping-text-labels"><i class="fa fa-angle-double-right"></i> Avoid overlapping text labels</h2>
<p>User can use <a href="https://cran.r-project.org/web/packages/ggrepel/">ggrepel</a> package to repel overlapping text labels.</p>
<p>For example:</p>
<pre><code class="r">library(ggrepel)
library(ggtree)
raxml_file &lt;- system.file(&quot;extdata/RAxML&quot;, &quot;RAxML_bipartitionsBranchLabels.H3&quot;, package=&quot;ggtree&quot;)
raxml &lt;- read.raxml(raxml_file)
ggtree(raxml) + geom_label_repel(aes(label=bootstrap, fill=bootstrap))
</code></pre>

<p>For details, please refer to <a href="https://cran.r-project.org/web/packages/ggrepel/vignettes/ggrepel.html">ggrepel usage examples</a>.</p>
<h2 id="bootstrap-values-from-newick-format"><i class="fa fa-angle-double-right"></i> bootstrap values from newick format</h2>
<p>It's quite command to store <code>bootstrap</code> value as node label in <code>newick</code> format. Visualizing node label is easy using <code>geom_text2(aes(subset = !isTip, label=label))</code>.</p>
<p>If you want to only display a subset of <code>bootstrap</code> (e.g. bootstrap &gt; 80), you can't simply using <code>geom_text2(subset= (label &gt; 80), label=label)</code> since <code>label</code> is a character vector, which contains node label (bootstrap value) and tip label (taxa name). If we use <code>geom_text2(subset=(as.numeric(label) &gt; 80), label=label)</code>, it will also fail since <code>NAs</code> were introduced by coercion. We need to convert <code>NAs</code> to logical <code>FALSE</code>, this can be done by the following code:</p>
<pre><code class="r">nwk &lt;- system.file(&quot;extdata/RAxML&quot;,&quot;RAxML_bipartitions.H3&quot;, package='ggtree')
tr &lt;- read.tree(nwk)
ggtree(tr) + geom_text2(aes(label=label, subset = !is.na(as.numeric(label)) &amp; as.numeric(label) &gt; 80))
</code></pre>

<p>Another solution is converting the bootstrap value outside <code>ggtree</code> as I recommended in <a href="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/bioc-ggtree/hiRBjGaAfI0/Y-2zDpvtAwAJ">google group</a>.</p>
<pre><code class="r">q &lt;- ggtree(tr)
d &lt;- q$data
d &lt;- d[!d$isTip,]
d$label &lt;- as.numeric(d$label)
d &lt;- d[d$label &gt; 80,]

q + geom_text(data=d, aes(label=label))
</code></pre>

<h1 id="aesthetic-mapping"><i class="fa fa-map-marker"></i> <em>aesthetic</em> mapping</h1>
<h2 id="inherit-aes"><i class="fa fa-angle-double-right"></i> inherit <em>aes</em></h2>
<pre><code class="r">ggtree(rtree(30)) + geom_point()
</code></pre>

<p>For example, we can add symbolic points to nodes with <code>geom_point()</code> directly.
The magic here is we don't need to map <code>x</code> and <code>y</code> position of the points by providing <code>aes(x, y)</code> to <code>geom_point()</code> since it was already mapped by <code>ggtree</code> function and it serves as a global mapping for all layers.</p>
<p>But what if we provide a <code>dataset</code> in a layer and the <code>dataset</code> doesn't contain column of <code>x</code> and/or <code>y</code>,
the layer function also try to map <code>x</code> and <code>y</code> and also others if you map them in <code>ggtree</code> function.
As these variable is not available in your <code>dataset</code>, you will get the following error:</p>
<pre><code>Error in eval(expr, envir, enclos) : object 'x' not found
</code></pre>

<p>This can be fixed by using parameter <code>inherit.aes=FALSE</code> which will disable inheriting mapping from <code>ggtree</code> function.</p>
<h2 id="use-in-aes"><i class="fa fa-angle-double-right"></i> use <code>$</code> in aes</h2>
<p>NEVER DO THIS.</p>
<p>see the explaination in the <a href="https://github.com/hadley/ggplot2-book/blob/master/layers.rmd#aesthetic-mappings-secaes">ggplot2 book 2ed</a>:</p>
<blockquote>
<p>Never refer to a variable with <code>$</code> (e.g., <code>diamonds$carat</code>) in <code>aes()</code>. This breaks containment, so that the plot no longer contains everything it needs, and causes problems if ggplot2 changes the order of the rows, as it does when facetting. \indexc{\$}</p>
</blockquote>
<p>see also
<a href="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/bioc-ggtree/hViM6vRZF94/MsZT8qRgBwAJ">1</a>
and <a href="https://github.com/GuangchuangYu/ggtree/issues/106">2</a>.</p>
<h1 id="annotation"><i class="fa fa-tree"></i> Annotation</h1>
<h2 id="colouring-edges-by-user-data"><i class="fa fa-angle-double-right"></i> colouring edges by user data</h2>
<p>see my answer on <a href="https://github.com/GuangchuangYu/ggtree/issues/76">https://github.com/GuangchuangYu/ggtree/issues/76</a>
and <a href="https://groups.google.com/forum/#!topic/bioc-ggtree/4GgivKqVjB8">https://groups.google.com/forum/#!topic/bioc-ggtree/4GgivKqVjB8</a>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
                <center>Copyright &copy; 2016 <a href="https://guangchuangyu.github.io">Guangchuang Yu</a>.<div style="width:250px;margin:auto;"><script type="text/javascript" src="//rf.revolvermaps.com/0/0/7.js?i=5qpvv5zz7fp&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;sx=0" async="async"></script></div></center>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>