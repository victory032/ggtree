---
title: "ggtree for PAML tree annotations"
author: "Guangchuang Yu <br />
        <guangchuangyu@gmail.com> <br />
        School of Public Health <br />
	Li Ka Shing Faculty of Medicine <br />
        The University of Hong Kong"
date: "`r Sys.Date()`"
output: BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{ggtree: phylogenetic tree viewer and annotator}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

```{r style, echo=FALSE, results="asis"}
BiocStyle::markdown()
```

## CODEML
### mlc file
```{r fig.width=8, tidy=TRUE, width=60, warning=FALSE}
library(ggtree)
mlcfile <- system.file("extdata/PAML_Codeml", "mlc", package="ggtree")
mlc <- read.codeml_mlc(mlcfile)
mlc
plot(mlc, branch.length="branch.length", annotation="dN/dS", ndigits=2)
```

The paramter `branch.length` can be one of available annotations:
```{r}
get.fields(mlc)
```

For example, if we set `branch.length` to `dN/dS`, it will plot the $\omega$ (`dN/dS`) tree:
```{r fig.width=8, tidy=TRUE, width=60, warning=FALSE}
plot(mlc, branch.length="dN/dS", annotation="dN/dS", ndigits=2)
```

We can also plot the `dN` or `dS` tree and others. The parameter `annotation` can also be one of the available annotations.

## rst file
```{r fig.width=12, fig.height=8, tidy=TRUE, width=60, warning=FALSE}
rstfile <- system.file("extdata/PAML_Codeml", "rst", package="ggtree")
tipfas <- system.file("extdata", "pa.fas", package="ggtree")
rst <- read.paml_rst(rstfile, tip.fasfile=tipfas)
rst
plot(rst, annotation="marginal_AA_subs")
```

## mlc and rst files in combination

We can annotate the tree with information presented in `rstfile` and `mlcfile` separately as demonstrated in previous sessions.

We recommend using them both, and user don't need to provide tip sequences, as it's already available in `mlcfile`. All the features in both files are available for annotation.


```{r fig.width=12, fig.height=8, tidy=TRUE, width=60, warning=FALSE}
ml <- read.codeml(rstfile, mlcfile)
ml
plot(ml, branch.length="rst.branch.length", annotation="dN/dS")
plot(ml, branch.length="mlc.branch.length", annotation="joint_AA_subs")
plot(ml, branch.length="dN/dS", annotation="joint_AA_subs")
```



## Session info
Here is the output of `sessionInfo()` on the system on which this document was compiled:
```{r echo=FALSE}
sessionInfo()
```
