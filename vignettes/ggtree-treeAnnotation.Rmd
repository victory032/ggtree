---
title: "ggtree: phylogenetic tree viewer and annotator"
author: "Guangchuang Yu <br /> 
	<guangchuangyu@gmail.com> <br /> 
	School of Public Health <br /> 
	The University of Hong Kong"
date: "`r Sys.Date()`"
output: BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{ggtree: phylogenetic tree viewer and annotator}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

```{r style, echo=FALSE, results="asis"}
BiocStyle::markdown()
```


## Tree visualization
For displaying a phylogenetic, please refer to the vignette, [ggtree-treeViewer](ggtree-treeViewer.html).


## Tree annotation

```{r fig.width=6, fig.height=5}
nwk <- system.file("extdata", "sample.nwk", package="ggtree")
library(ape)
tree <- read.tree(nwk)
library(ggplot2)
library(ggtree)
p <- ggtree(tree)
```

Suppose we have the following data that associated with the tree and would like to attach the data in the tree.

```{r}
dd <- data.frame(taxa=LETTERS[1:13], 
      		 place=c(rep("GZ", 5), rep("HK", 3), rep("CZ", 4), NA),
                 value=round(abs(rnorm(13, mean=70, sd=10)), digits=1))
## you don't need to order the data
## data was reshuffled just for demonstration
dd <- dd[sample(1:13, 13), ]
row.names(dd) <- NULL
```
```{r eval=FALSE}
print(dd)
```

```{r echo=FALSE, results='asis'}
knitr::kable(dd)
```

We can imaging that the `place` column is the place we isolated the species and `value` column stored numerical values for example bootstrap values.

In [ggtree-treeViewer](ggtree-treeViewer.html), we have shown using the operator, `%<%`, to update a tree view with a new tree. Here, we will introduce another operator, `%<+%`, that attach annotation data to a tree view. The only requirement of the input data is that its first column should be matched with the tip labels of the tree.

After attaching the annotation data to the tree by `%<+%`, all the columns in the data are visible to `ggplot2`. As an example, here we attach the above annotation data to the tree view, `p`, and add a layer that showing the tip labels and colored by the isolation site stored in `place` column.

```{r fig.width=6, fig.height=5, warning=FALSE}
p <- p %<+% dd + geom_text(aes(color=place, label=label), hjust=-0.5)
print(p)
```

We can add another layer to display the isolation sites.
```{r fig.width=6, fig.height=5, warning=FALSE}
p <- p + geom_text(aes(color=place, label=place), hjust=1, vjust=-0.4, size=3)
print(p)
```

And another layer showing numerical values:
```{r fig.width=6, fig.height=5, warning=FALSE}
p <- p + geom_text(aes(color=place, label=value), hjust=1, vjust=1.4, size=3)
print(p)
```

```{r fig.width=7, fig.height=5, warning=FALSE}
p <- p + geom_point(aes(size=value, shape=place, color=place), alpha=0.25, subset=.(isTip))
print(p)
```

## Session info
Here is the output of `sessionInfo()` on the system on which this document was compiled:
```{r echo=FALSE}
sessionInfo()
```
